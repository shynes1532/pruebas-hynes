<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Concesionario Bot</title>
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <%- include('partials/sidebar', { page: 'dashboard' }) %>
  <main class="content">
    <div class="page-header">
      <h1>Dashboard</h1>
      <p>Resumen general del bot de WhatsApp</p>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number"><%= stats.totalLeads %></div>
        <div class="stat-label">Leads totales</div>
      </div>
      <div class="stat-card highlight">
        <div class="stat-number"><%= stats.newLeads %></div>
        <div class="stat-label">Leads nuevos</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= stats.pendingAppointments %></div>
        <div class="stat-label">Citas pendientes</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= stats.totalQuotes %></div>
        <div class="stat-label">Cotizaciones</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= stats.totalConversations %></div>
        <div class="stat-label">Conversaciones</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= stats.todayMessages %></div>
        <div class="stat-label">Mensajes hoy</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= stats.totalVehicles %></div>
        <div class="stat-label">Vehiculos activos</div>
      </div>
    </div>

    <div class="grid-2col">
      <div class="card">
        <h3>Leads Recientes</h3>
        <table>
          <thead>
            <tr><th>Telefono</th><th>Nombre</th><th>Interes</th><th>Estado</th><th>Fecha</th></tr>
          </thead>
          <tbody>
            <% recentLeads.forEach(function(l) { %>
            <tr>
              <td><%= l.phone %></td>
              <td><%= l.name || '-' %></td>
              <td><%= l.vehicle_interest || '-' %></td>
              <td><span class="badge badge-<%= l.status %>"><%= l.status %></span></td>
              <td><%= new Date(l.created_at).toLocaleDateString('es-AR') %></td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <a href="/admin/leads" class="btn-link">Ver todos los leads &rarr;</a>
      </div>

      <div class="card">
        <h3>Proximas Citas</h3>
        <table>
          <thead>
            <tr><th>Nombre</th><th>Tipo</th><th>Vehiculo</th><th>Fecha</th><th>Hora</th><th>Estado</th></tr>
          </thead>
          <tbody>
            <% upcomingAppointments.forEach(function(a) { %>
            <tr>
              <td><%= a.name %></td>
              <td><%= a.appointment_type %></td>
              <td><%= a.vehicle_info || '-' %></td>
              <td><%= a.date %></td>
              <td><%= a.time_slot %></td>
              <td><span class="badge badge-<%= a.status %>"><%= a.status %></span></td>
            </tr>
            <% }); %>
          </tbody>
        </table>
        <a href="/admin/appointments" class="btn-link">Ver todas las citas &rarr;</a>
      </div>
    </div>

    <div class="card">
      <h3>Vehiculos Mas Consultados</h3>
      <% if (topVehicles.length > 0) { %>
        <div class="top-vehicles">
          <% topVehicles.forEach(function(v, i) { %>
          <div class="top-vehicle">
            <span class="rank">#<%= i + 1 %></span>
            <span class="name"><%= v.vehicle_interest %></span>
            <span class="count"><%= v.count %> consultas</span>
          </div>
          <% }); %>
        </div>
      <% } else { %>
        <p class="empty-state">Sin datos todavia</p>
      <% } %>
    </div>
  </main>
</body>
</html>
